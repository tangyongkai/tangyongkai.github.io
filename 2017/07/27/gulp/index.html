<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>gulp | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="1.什么是gulpgulp是可以自动化执行任务的工具 在平时开发的流程里面,一定有一些任务需要手工重复得执行，比如:  把文件从开发目录拷贝到生产目录 把多个 JS 或者 CSS 文件合并成一个文件 对JS文件和CSS进行压缩 把sass或者less文件编译成CSS 压缩图像文件 创建一个可以实时刷新页面内容的本地服务器  只要你觉得有些动作是要重复去做的,就可以把这些动作创建成一个gulp任务">
<meta name="keywords">
<meta property="og:type" content="article">
<meta property="og:title" content="gulp">
<meta property="og:url" content="http://yoursite.com/2017/07/27/gulp/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="1.什么是gulpgulp是可以自动化执行任务的工具 在平时开发的流程里面,一定有一些任务需要手工重复得执行，比如:  把文件从开发目录拷贝到生产目录 把多个 JS 或者 CSS 文件合并成一个文件 对JS文件和CSS进行压缩 把sass或者less文件编译成CSS 压缩图像文件 创建一个可以实时刷新页面内容的本地服务器  只要你觉得有些动作是要重复去做的,就可以把这些动作创建成一个gulp任务">
<meta property="og:updated_time" content="2017-07-31T02:14:36.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="gulp">
<meta name="twitter:description" content="1.什么是gulpgulp是可以自动化执行任务的工具 在平时开发的流程里面,一定有一些任务需要手工重复得执行，比如:  把文件从开发目录拷贝到生产目录 把多个 JS 或者 CSS 文件合并成一个文件 对JS文件和CSS进行压缩 把sass或者less文件编译成CSS 压缩图像文件 创建一个可以实时刷新页面内容的本地服务器  只要你觉得有些动作是要重复去做的,就可以把这些动作创建成一个gulp任务">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-gulp" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/07/27/gulp/" class="article-date">
  <time datetime="2017-07-27T05:57:03.000Z" itemprop="datePublished">2017-07-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      gulp
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="1-什么是gulp"><a href="#1-什么是gulp" class="headerlink" title="1.什么是gulp"></a>1.什么是gulp</h2><p><strong>gulp</strong>是可以自动化执行任务的工具 在平时开发的流程里面,一定有一些任务需要手工重复得执行，比如:</p>
<ul>
<li>把文件从开发目录<strong>拷贝</strong>到生产目录</li>
<li>把多个 JS 或者 CSS 文件<strong>合并</strong>成一个文件</li>
<li>对JS文件和CSS进行<strong>压缩</strong></li>
<li>把sass或者less文件<strong>编译</strong>成CSS</li>
<li><strong>压缩图像</strong>文件</li>
<li>创建一个可以<strong>实时刷新</strong>页面内容的本地服务器</li>
</ul>
<p>只要你觉得有些动作是要<strong>重复</strong>去做的,就可以把这些动作创建成一个gulp任务 然后在指定的条件下自动执行 比如在less源文件发生改变后自动编译成css文件</p>
<h2 id="2-gulp特点"><a href="#2-gulp特点" class="headerlink" title="2.gulp特点"></a>2.gulp特点</h2><ul>
<li><strong>易于使用</strong> 通过代码优于配置的策略，Gulp 让简单的任务简单，复杂的任务可管理。</li>
<li><strong>快速构建</strong> 利用 node.js 流的威力，你可以快速构建项目并减少频繁的 IO 操作。前一级的输出，直接变成后一级的输入，使得在操作上非常简单</li>
<li><strong>高质量的插件</strong> Gulp 严格的插件指南确保插件如你期望的那样简洁地工作。</li>
<li><strong>易于学习</strong> 通过最少的 API，掌握 gulp 毫不费力，构建工作尽在掌握。<h2 id="3-安装gulp"><a href="#3-安装gulp" class="headerlink" title="3.安装gulp"></a>3.安装gulp</h2>在项目里使用gulp需要</li>
<li>安装node</li>
<li>在全局范围内去安装一下gulp的命令行工具</li>
<li>然后在项目里面再去本地安装gulp<h4 id="3-1安装node"><a href="#3-1安装node" class="headerlink" title="3.1安装node"></a>3.1安装node</h4>gulp是基于Nodejs的自动任务运行器 安装Gulp和相关行件用的都是node的包管理工具npm 所以你需要先在电脑上安装 node,确定在命令行工具的下面可以使用npm这个命令，这样就能去安装Gulp了<br>安装好以后，我们可以打开命令行工具，mac 用户可以使用终端工具，windows 用户可以找到cmd命令行工具。<h4 id="3-2gulp命令行工具"><a href="#3-2gulp命令行工具" class="headerlink" title="3.2gulp命令行工具"></a>3.2gulp命令行工具</h4></li>
<li>使用 npm install 去安装 gulp，注意加上一个 -g 的参数，表示在全局范围内去安装.</li>
<li>一般用 npm 安装的时候用一个 -g 的参数就表示，这个安装的东西会作为命令去执行。</li>
<li>如果你在mac或linux下遇到了权限问题,在下面这个命令的前面加上 sudo npm install gulp -g 并输入mac密码。<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install -g gulp</div></pre></td></tr></table></figure>
</li>
</ul>
<p>安装完成后可以输入 gulp –help 如果输出一些帮助的信息就表示可以gulp命令行成功安装了</p>
<p>如果安装不上可以换一下源试试</p>
<ul>
<li>淘宝源 npm install -g gulp –registry=<a href="http://registry.npm.taobao.org" target="_blank" rel="external">http://registry.npm.taobao.org</a></li>
<li>中国源 npm install -g gulp –registry=<a href="http://registry.cnpmjs.org" target="_blank" rel="external">http://registry.cnpmjs.org</a></li>
<li>官方源 npm install -g gulp –registry=<a href="http://www.npmjs.org/" target="_blank" rel="external">http://www.npmjs.org/</a><h4 id="3-3-gulp本地安装"><a href="#3-3-gulp本地安装" class="headerlink" title="3.3 gulp本地安装"></a>3.3 gulp本地安装</h4>1.先创建一个目录 在 mac 和 linux 操作系统下创建一个文件夹<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ mkdir learngulp</div></pre></td></tr></table></figure>
</li>
</ul>
<p>2.使用 cd 命令进入此目录<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ cd learngulp</div></pre></td></tr></table></figure></p>
<p>3.创建项目描述文件package.json 项目需要一个叫package.json的文件来管理项目的配置,可以使用 npm init 这个命令生成<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">$ npm init</div><div class="line"></div><div class="line"> name: (zhufeng_automation) learngulp //项目名称</div><div class="line"> version: (1.0.0) 1.0.0   //项目版本号</div><div class="line"> description: learn gulp //项目说明</div><div class="line"> entry point: (index.js) index.js // 入口文件</div><div class="line"> test command: test.js //测试脚本 执行npm test时会执行此文件</div><div class="line"> git repository: (https://github.git) //模块的git仓库</div><div class="line"> keywords: node.js gulp  //在npmjs官网搜索时的关键字</div><div class="line"> author: zhufengpeixun //项目作者名字</div><div class="line"> license: (ISC) MIT //授权协议</div><div class="line"> About to write to D:\mygit\zhufeng_automation\package.json:</div><div class="line"> Is this ok? (yes) yes //直接回车确认</div></pre></td></tr></table></figure></p>
<p>回车后会在当前目录下创建一个 package.json 文件</p>
<p>4.本地安装gulp到开发依赖中<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install gulp --save-dev</div></pre></td></tr></table></figure></p>
<p>这样可以把 gulp 作为项目的开发依赖(只在开发时用，不会发布到线上) 第一会在node_modules下安装本地的gulp库 第二会把并把添加配置到package.json文件里面<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&quot;devDependencies&quot;:&#123;</div><div class="line">        &quot;gulp&quot;: &quot;^3.9.0&quot;</div><div class="line">      &#125;</div></pre></td></tr></table></figure></p>
<h2 id="4-运行gulp"><a href="#4-运行gulp" class="headerlink" title="4.运行gulp"></a>4.运行gulp</h2><h4 id="4-1创建配置文件"><a href="#4-1创建配置文件" class="headerlink" title="4.1创建配置文件"></a>4.1创建配置文件</h4><p>gulp的任务要放到一个叫 gulpfile.js 的文件里面 先在项目的根目录下面创建一个这样的文件 然后在这个文件的顶部添加下面这行代码<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> gulp = <span class="built_in">require</span>(<span class="string">'gulp'</span>);</div></pre></td></tr></table></figure></p>
<p>通过require可以把gulp模块引入当前项目并赋值给gulp变量 这样gulp这个变量里面就会拥有gulp的所有的方法了</p>
<h4 id="4-2创建gulp的任务"><a href="#4-2创建gulp的任务" class="headerlink" title="4.2创建gulp的任务"></a>4.2创建gulp的任务</h4><p>可以使用gulp的task方法 同样我们去创建一个叫 hello 的任务，它要做的事就是在控制台上输出 “您好” 这两个字</p>
<p>1.第一个参数是任务的名称</p>
<p>2.第二个参数是任务的定义,是一个匿名函数<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">gulp.task(<span class="string">'hello'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">   <span class="built_in">console</span>.log(<span class="string">'您好'</span>);</div><div class="line"> &#125;);</div></pre></td></tr></table></figure></p>
<h4 id="4-3执行gulp任务"><a href="#4-3执行gulp任务" class="headerlink" title="4.3执行gulp任务"></a>4.3执行gulp任务</h4><p>打开命令行工具，进入到项目所在的目录，然后输入：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ gulp hello</div></pre></td></tr></table></figure></p>
<p>会返回：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[21:36:34] Starting &apos;hello&apos;...</div><div class="line">    您好</div><div class="line">    [21:36:34] Finished &apos;hello&apos; after 959 μs</div></pre></td></tr></table></figure></p>
<p>gulp后面跟着的是任务的名称 不输入任务名称的话会默认找default任务，找不到会报错</p>
<h4 id="4-4执行其它任务"><a href="#4-4执行其它任务" class="headerlink" title="4.4执行其它任务"></a>4.4执行其它任务</h4><p>可以使用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ gulp &lt;task&gt; &lt;othertask&gt;</div></pre></td></tr></table></figure></p>
<h2 id="5-gulp参数"><a href="#5-gulp参数" class="headerlink" title="5.gulp参数"></a>5.gulp参数</h2><p>gulp 只有你需要熟知的参数标记，其他所有的参数标记只在一些任务需要的时候使用。</p>
<ul>
<li>-v 或 –version 会显示全局和项目本地所安装的 gulp版本号</li>
<li>–gulpfile 手动指定一个 gulpfile 的路径，这在你有很多个 gulpfile 的时候很有用。这也会将 CWD 设置到该 gulpfile 所在目录</li>
<li>–cwd dirpath 手动指定 CWD。定义 gulpfile 查找的位置，此外，所有的相应的依赖（require）会从这里开始计算相对路径</li>
<li>-T 或 –tasks 会显示所指定 gulpfile 的 task 依赖树</li>
<li>–color 强制 gulp 和 gulp 插件显示颜色，即便没有颜色支持</li>
<li>–no-color 强制不显示颜色，即便检测到有颜色支持</li>
<li>–silent 禁止所有的 gulp 日志<h2 id="6-gulp-js工作方式"><a href="#6-gulp-js工作方式" class="headerlink" title="6.gulp.js工作方式"></a>6.gulp.js工作方式</h2>gulp的使用流程一般是:</li>
</ul>
<p>1.首先通过gulp.src()方法获取到想要处理的文件流</p>
<p>2.然后把文件流通过pipe方法导入到gulp的插件中</p>
<p>3.最后把经过插件处理后的流再通过pipe方法导入到gulp.dest()中</p>
<p>4.gulp.dest()方法则把流中的内容写入到文件中<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> gulp = <span class="built_in">require</span>(<span class="string">'gulp'</span>);</div><div class="line">    gulp.src(<span class="string">'script/src.js'</span>)             <span class="comment">// 获取文件的流的api</span></div><div class="line">        .pipe(gulp.dest(<span class="string">'dist/dest.js'</span>)); <span class="comment">// 写文件的api</span></div></pre></td></tr></table></figure></p>
<h2 id="7-gulp核心API"><a href="#7-gulp核心API" class="headerlink" title="7. gulp核心API"></a>7. gulp核心API</h2><p><strong>gulp只有4个核心API</strong></p>
<h4 id="7-1-gulp-src"><a href="#7-1-gulp-src" class="headerlink" title="7.1 gulp.src()"></a>7.1 gulp.src()</h4><p>在Gulp中，使用的是Nodejs中的stream(流)，首先获取到需要的stream 然后可以通过stream的pipe方法把流导入到你想要的地方 比如Gulp的插件中,经过插件处理后的流又可以继续导入到其他插件中，当然也可以把流写入到文件中 所以Gulp是以stream为媒介的，它不需要频繁的生成临时文件，这也是Gulp的速度快的一个原因 gulp.src()方法正是用来获取流的</p>
<p>但要注意这个流里的内容不是原始的文件流,而是一个虚拟文件对象流,这个虚拟文件对象中存储着原始文件的路径、文件名和内容等信息 vinyl<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> File = <span class="built_in">require</span>(<span class="string">'vinyl'</span>);</div><div class="line"></div><div class="line"><span class="keyword">var</span> indexFile = <span class="keyword">new</span> File(&#123;</div><div class="line">    <span class="attr">cwd</span>: <span class="string">"/"</span>,</div><div class="line">    <span class="attr">base</span>: <span class="string">"/test/"</span>,</div><div class="line">    <span class="attr">path</span>: <span class="string">"/test/index.js"</span>,</div><div class="line">    <span class="attr">contents</span>: <span class="keyword">new</span> Buffer(<span class="string">"name=zfpx"</span>)</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(File.isVinyl(indexFile));</div><div class="line"><span class="built_in">console</span>.log(indexFile.isBuffer());</div><div class="line"><span class="built_in">console</span>.log(indexFile.isStream());</div></pre></td></tr></table></figure></p>
<p>其语法为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gulp.src(globs[, options])</div></pre></td></tr></table></figure></p>
<ul>
<li>globs 参数是文件匹配模式(类似正则表达式)，用来匹配文件路径(包括文件名)，当然这里也可以直接指定某个具体的文件路径。当有多个匹配模式时，该参数可以为一个数组</li>
<li><p>options 为可选参数。通常情况下我们不需要用到</p>
<h4 id="7-2-gulp-dest"><a href="#7-2-gulp-dest" class="headerlink" title="7.2  gulp.dest()"></a>7.2  gulp.dest()</h4><p>是用来向硬盘写入文件的，其语法为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gulp.dest(path[,options])</div></pre></td></tr></table></figure>
</li>
<li><p>path 为写入文件的路径</p>
</li>
<li>options 为一个可选的参数对象，通常我们不需要用到<br>要想使用好<strong>gulp.dest()</strong>这个方法，就要理解给它传入的路径参数与最终生成的文件的关系。</li>
</ul>
<p><strong>gulp.dest()</strong>传入的路径参数只能用来指定要生成的文件的目录,而不能指定生成文件的文件名 它生成文件的文件名使用的是导入到它的文件流自身的文件名 所以生成的文件名是由导入到它的文件流决定的<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> gulp = <span class="built_in">require</span>(<span class="string">'gulp'</span>);</div><div class="line">     gulp.src(<span class="string">'script/jquery.js'</span>)</div><div class="line">    .pipe(gulp.dest(<span class="string">'dist/jquery.js'</span>));</div><div class="line">    <span class="comment">//最终生成的文件路径为 dist/jquery.js/jquery.js,而不是dist/jquery.js</span></div><div class="line"><span class="comment">//gulp.dest(path)生成的文件路径是我们传入的path参数后面再加上gulp.src()中有通配符开始出现的那部分路径</span></div><div class="line"></div><div class="line"><span class="comment">//通过指定gulp.src()方法配置参数中的base属性，我们可以更灵活的来改变gulp.dest()生成的文件路径</span></div><div class="line"></div><div class="line"> <span class="comment">//配置了base参数，此时base路径为script</span></div><div class="line">gulp.src(<span class="string">'script/lib/*.js'</span>, &#123;<span class="attr">base</span>:<span class="string">'script'</span>&#125;)</div><div class="line">    <span class="comment">//假设匹配到的文件为script/lib/jquery.js</span></div><div class="line">    <span class="comment">//此时生成的文件路径为 build/lib/jquery.js</span></div><div class="line">    .pipe(gulp.dest(<span class="string">'build'</span>))</div></pre></td></tr></table></figure></p>
<h4 id="7-3gulp-task"><a href="#7-3gulp-task" class="headerlink" title="7.3gulp.task()"></a>7.3gulp.task()</h4><p>gulp.task方法用来定义任务，其语法为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gulp.task(name[, deps], fn)</div></pre></td></tr></table></figure></p>
<ul>
<li>name 为任务名称</li>
<li>deps 是当前定义的任务需要依赖的其他任务，为一个数组。当前定义的任务会在所有依赖的任务执行完毕后才开始执行。如果没有依赖，则可省略这个参数</li>
<li>fn 为任务定义函数，我们把任务要执行的代码都写在里面。该参数也是可选的。<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">gulp.task(<span class="string">'mytask'</span>, [<span class="string">'array'</span>, <span class="string">'of'</span>, <span class="string">'task'</span>, <span class="string">'names'</span>],</div><div class="line">   <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="comment">//定义一个有依赖的任务</span></div><div class="line">      <span class="comment">// Do something</span></div><div class="line">  &#125;);</div></pre></td></tr></table></figure>
</li>
</ul>
<p>如果某个任务所依赖的任务是异步的，就要注意了，gulp并不会等待那个所依赖的异步任务完成，而是会接着执行后续的任务<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//two任务虽然依赖于one任务,但并不会等到one任务中的异步操作完成后再执行</span></div><div class="line">gulp.task(<span class="string">'one'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">      <span class="comment">//one是一个异步执行的任务</span></div><div class="line">      setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'one is done'</span>)</div><div class="line">      &#125;,<span class="number">5000</span>);</div><div class="line">    &#125;);</div><div class="line"> gulp.task(<span class="string">'two'</span>,[<span class="string">'one'</span>],<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">      <span class="built_in">console</span>.log(<span class="string">'two is done'</span>);</div><div class="line">    &#125;);</div></pre></td></tr></table></figure></p>
<p>在异步操作完成后执行一个回调函数来通知gulp这个异步任务已经完成,这个回调函数就是任务函数的第一个参数<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">gulp.task(<span class="string">'one'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">cb</span>)</span>&#123; <span class="comment">//cb为任务函数提供的回调，用来通知任务已经完成</span></div><div class="line">      <span class="comment">//one是一个异步执行的任务</span></div><div class="line">      setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'one is done'</span>);</div><div class="line">        cb();  <span class="comment">//执行回调，表示这个异步任务已经完成</span></div><div class="line">      &#125;,<span class="number">5000</span>);</div><div class="line">    &#125;);</div></pre></td></tr></table></figure></p>
<h4 id="7-4gulp-watch"><a href="#7-4gulp-watch" class="headerlink" title="7.4gulp.watch()"></a>7.4gulp.watch()</h4><p>用来监视文件的变化，当文件发生变化后，我们可以利用它来执行相应的任务，例如文件拷贝等。其语法为<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gulp.watch(glob[, opts], tasks)</div></pre></td></tr></table></figure></p>
<ul>
<li>glob 为要监视的文件匹配模式，规则和用法与gulp.src()方法中的 glob 相同。</li>
<li>opts 为一个可选的配置对象，通常不需要用到</li>
<li>tasks 为文件变化后要执行的任务，为一个数组<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">gulp.task(<span class="string">'uglify'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">   <span class="comment">//do something</span></div><div class="line"> &#125;);</div><div class="line"> gulp.task(<span class="string">'reload'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">   <span class="comment">//do something</span></div><div class="line"> &#125;);</div><div class="line"> gulp.watch(<span class="string">'js/**/*.js'</span>, [<span class="string">'uglify'</span>,<span class="string">'reload'</span>]);</div></pre></td></tr></table></figure>
</li>
</ul>
<p>另外一种使用方式：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gulp.watch(glob[, opts, cb])</div></pre></td></tr></table></figure></p>
<ul>
<li>glob和 opts 参数与第一种用法相同</li>
<li>cb参数为一个函数。每当监视的文件发生变化时，就会调用这个函数,并且会给它传入一个对象，该对象包含了文件变化的一些信息 type属性为变化的类型，可以是 added、changed、deleted和path属性为发生变化的文件的路径<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">gulp.watch(<span class="string">'js/**/*.js'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</div><div class="line">    <span class="comment">//变化类型 added为新增,deleted为删除，changed为改变</span></div><div class="line">    <span class="built_in">console</span>.log(event.type);</div><div class="line">    <span class="comment">//变化的文件的路径</span></div><div class="line">    <span class="built_in">console</span>.log(event.path);</div><div class="line">  &#125;);</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="8-基本任务"><a href="#8-基本任务" class="headerlink" title="8.基本任务"></a>8.基本任务</h2><h4 id="8-1复制单个文件"><a href="#8-1复制单个文件" class="headerlink" title="8.1复制单个文件"></a>8.1复制单个文件</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> gulp = <span class="built_in">require</span>(<span class="string">'gulp'</span>);</div><div class="line">     gulp.task(<span class="string">'copy-html'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">         <span class="keyword">return</span> gulp.src(<span class="string">'app/index.html'</span>).pipe(gulp.dest(<span class="string">'dist'</span>));</div><div class="line">     &#125;);</div></pre></td></tr></table></figure>
<h4 id="8-2-复制多个文件"><a href="#8-2-复制多个文件" class="headerlink" title="8.2 复制多个文件"></a>8.2 复制多个文件</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> gulp = <span class="built_in">require</span>(<span class="string">'gulp'</span>);</div><div class="line">   <span class="comment">//复制图片</span></div><div class="line">   gulp.task(<span class="string">'copy-images'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">       <span class="keyword">return</span> gulp.src(<span class="string">'app/imgs/*.jpg'</span>)</div><div class="line">       .pipe(gulp.dest(<span class="string">'dist'</span>));</div><div class="line">   &#125;);</div><div class="line"></div><div class="line">   <span class="comment">/**</span></div><div class="line">    * 1. &#123;&#125; 里可以指定多个扩展名</div><div class="line">    * 2. * 匹配所有的字符，除了路径分隔符 /</div><div class="line">    * 3. ** 匹配所有的字符，包括路径分隔符 /</div><div class="line">    */</div><div class="line">   gulp.task(<span class="string">'copy-images'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">       <span class="keyword">return</span> gulp.src(<span class="string">'app/imgs/**/*.&#123;jpg,png&#125;'</span>)</div><div class="line">       .pipe(gulp.dest(<span class="string">'dist'</span>));</div><div class="line">   &#125;);</div><div class="line"></div><div class="line">   <span class="comment">/**</span></div><div class="line">    * 1. 匹配多个目录 glob</div><div class="line">    * 2. 可以填写一个数组</div><div class="line">    */</div><div class="line">   gulp.task(<span class="string">'copy-other'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">           <span class="keyword">return</span> gulp.src([<span class="string">'app/css/*.css'</span>,<span class="string">'app/js/*.js'</span>],&#123;<span class="attr">base</span>:<span class="string">'app'</span>&#125;)</div><div class="line">           .pipe(gulp.dest(<span class="string">'dist'</span>));</div><div class="line">       &#125;);</div><div class="line">   </div><div class="line">       <span class="comment">/**</span></div><div class="line">        * 1. 匹配多个目录 glob</div><div class="line">        * 2. !表示 排除一个文件</div><div class="line">        */</div><div class="line">       gulp.task(<span class="string">'copy-other'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">           <span class="keyword">return</span> gulp.src([<span class="string">'app/css/*.css'</span>,<span class="string">'app/js/*.js'</span></div><div class="line">           ,<span class="string">'!app/js/*.tmp.js'</span>],&#123;<span class="attr">base</span>:<span class="string">'app'</span>&#125;)</div><div class="line">           .pipe(gulp.dest(<span class="string">'dist'</span>));</div><div class="line">       &#125;);</div></pre></td></tr></table></figure>
<h4 id="8-3组合任务"><a href="#8-3组合任务" class="headerlink" title="8.3组合任务"></a>8.3组合任务</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> gulp = <span class="built_in">require</span>(<span class="string">'gulp'</span>);</div><div class="line"></div><div class="line">   gulp.task(<span class="string">'copy-html'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">       <span class="keyword">return</span> gulp.src(<span class="string">'app/index.html'</span>).pipe(gulp.dest(<span class="string">'dist'</span>));</div><div class="line">   &#125;);</div><div class="line"></div><div class="line">   gulp.task(<span class="string">'copy-images'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">       <span class="keyword">return</span> gulp.src(<span class="string">'app/imgs/**/*.&#123;jpg,png&#125;'</span>).pipe(gulp.dest(<span class="string">'dist'</span>));</div><div class="line">   &#125;);</div><div class="line"></div><div class="line">   gulp.task(<span class="string">'copy-other'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">       <span class="keyword">return</span> gulp.src([<span class="string">'app/css/*.css'</span>,<span class="string">'app/js/*.js'</span>,<span class="string">'app/js/*.tmp.js'</span>],&#123;<span class="attr">base</span>:<span class="string">'app'</span>&#125;).pipe(gulp.dest(<span class="string">'dist'</span>));</div><div class="line">   &#125;);</div><div class="line"></div><div class="line"></div><div class="line">   gulp.task(<span class="string">'default'</span>,[<span class="string">'copy-html'</span>,<span class="string">'copy-images'</span>,<span class="string">'copy-other'</span>],<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">       <span class="built_in">console</span>.log(<span class="string">'全部拷贝任务执行完毕!'</span>);</div><div class="line">   &#125;);</div></pre></td></tr></table></figure>
<h4 id="8-3监听任务"><a href="#8-3监听任务" class="headerlink" title="8.3监听任务"></a>8.3监听任务</h4><p>使用 gulp 的 watch 这个方法，我们可以去监视一些文件，当这些文件发生变化的时候，立即去执行一些指定的任务<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> gulp = <span class="built_in">require</span>(<span class="string">'gulp'</span>);</div><div class="line"></div><div class="line">    gulp.task(<span class="string">'copy-html'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">return</span> gulp.src(<span class="string">'app/index.html'</span>)</div><div class="line">        .pipe(gulp.dest(<span class="string">'dist'</span>));</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    gulp.task(<span class="string">'copy-images'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">return</span> gulp.src(<span class="string">'app/imgs/**/*.&#123;jpg,png&#125;'</span>,&#123;<span class="attr">base</span>:<span class="string">'app'</span>&#125;)</div><div class="line">        .pipe(gulp.dest(<span class="string">'dist'</span>));</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    gulp.task(<span class="string">'copy-other'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">return</span> gulp.src([<span class="string">'app/css/*.css'</span>,<span class="string">'app/js/*.js'</span></div><div class="line">        ,<span class="string">'app/js/*.tmp.js'</span>],&#123;<span class="attr">base</span>:<span class="string">'app'</span>&#125;).pipe(gulp.dest(<span class="string">'dist'</span>));</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    <span class="comment">//在执行watch的时候会监控index.html文件的变化，发生变化后可以执行拷贝html的任务</span></div><div class="line">    gulp.task(<span class="string">'default'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        gulp.watch(<span class="string">'app/index.html'</span>,[<span class="string">'copy-html'</span>]);</div><div class="line">        gulp.watch(<span class="string">'app/imgs/**/*.&#123;jpg,png&#125;'</span>,[<span class="string">'copy-images'</span>]);</div><div class="line">        gulp.watch([<span class="string">'app/css/*.css'</span>,<span class="string">'app/js/*.js'</span></div><div class="line">        ,<span class="string">'app/js/*.tmp.js'</span>],[<span class="string">'copy-other'</span>]);</div><div class="line">    &#125;);</div></pre></td></tr></table></figure></p>
<h2 id="9-gulp插件"><a href="#9-gulp插件" class="headerlink" title="9.gulp插件"></a>9.gulp插件</h2><p>gulp提供了一些很实用的接口，但本身并不能做太多的事情 可以读取文件、写入文件以及监控文件等一少部分功能 其它实用的功能都是依靠插件来进行扩展的 这些插件可以实现比如</p>
<ul>
<li>编译 Sass：gulp-sass</li>
<li>编译 Less：gulp-less</li>
<li>合并文件：gulp-concat</li>
<li>压缩js 文件：gulp-uglify</li>
<li>重命名js文件：gulp-rename</li>
<li>优化图像大小：gulp-imagemin</li>
<li>压缩css 文件：gulp-minify-css</li>
<li>创建本地服务器：gulp-connect</li>
<li>实时预览 gulp-connect<h4 id="9-1使用插件步骤"><a href="#9-1使用插件步骤" class="headerlink" title="9.1使用插件步骤"></a>9.1使用插件步骤</h4>1.npm install xxx –save-dev 安装插件</li>
</ul>
<p>2.在 gulpfile.js 顶部引入此插件</p>
<p>3.在创建任务的时候使用此插件</p>
<h4 id="9-2gulp-load-plugins"><a href="#9-2gulp-load-plugins" class="headerlink" title="9.2gulp-load-plugins"></a>9.2gulp-load-plugins</h4><p>这个插件能自动帮你加载package.json文件里的gulp插件。 例如假设你的package.json文件里的依赖是这样的:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&quot;devDependencies&quot;: &#123;</div><div class="line">       &quot;gulp&quot;: &quot;^3.9.0&quot;,</div><div class="line">       &quot;gulp-concat&quot;: &quot;^2.6.0&quot;,</div><div class="line">       &quot;gulp-connect&quot;: &quot;^2.2.0&quot;</div><div class="line">     &#125;</div></pre></td></tr></table></figure></p>
<p>然后我们可以在gulpfile.js中使用gulp-load-plugins来帮我们加载插件<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> gulp = <span class="built_in">require</span>(<span class="string">'gulp'</span>);</div><div class="line">    <span class="keyword">var</span> $ = <span class="built_in">require</span>(<span class="string">'gulp-load-plugins'</span>)();</div></pre></td></tr></table></figure></p>
<p>然后我们要使用gulp-concat和gulp-connect这两个插件的时候， 就可以使用$.concat和$.connect来代替了,也就是原始插件名去掉gulp-前缀，之后再转换为驼峰命名。</p>
<h4 id="9-3less"><a href="#9-3less" class="headerlink" title="9.3less"></a>9.3less</h4><p>less插件可以把less文件编译成css<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$    npm install gulp-less --save-dev</div></pre></td></tr></table></figure></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> gulp = <span class="built_in">require</span>(<span class="string">'gulp'</span>);</div><div class="line">    <span class="keyword">var</span> less = <span class="built_in">require</span>(<span class="string">'gulp-less'</span>);</div><div class="line"></div><div class="line">    gulp.task(<span class="string">'less'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">return</span> gulp.src(<span class="string">'app/less/*.less'</span>)</div><div class="line">        .pipe(less())</div><div class="line">        .pipe(gulp.dest(<span class="string">'dist/css'</span>));</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    gulp.task(<span class="string">'default'</span>,[<span class="string">'less'</span>]);</div></pre></td></tr></table></figure>
<h4 id="9-4gulp-concat"><a href="#9-4gulp-concat" class="headerlink" title="9.4gulp-concat"></a>9.4gulp-concat</h4><p>这个插件可以把几个文件合并到一块<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$    npm install gulp-concat --save-dev</div></pre></td></tr></table></figure></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> gulp = <span class="built_in">require</span>(<span class="string">'gulp'</span>);</div><div class="line">  <span class="keyword">var</span> concat = <span class="built_in">require</span>(<span class="string">'gulp-concat'</span>);</div><div class="line"></div><div class="line">  gulp.task(<span class="string">'concat'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">      <span class="keyword">return</span> gulp.src([<span class="string">'app/js/*.js'</span>,<span class="string">'!app/js/*.tmp.js'</span>])<span class="comment">//指定要合并的文件glob</span></div><div class="line">          .pipe(concat(<span class="string">'app.js'</span>))<span class="comment">//进行合并并指定合并后的文件名</span></div><div class="line">          .pipe(gulp.dest(<span class="string">'dist/js'</span>));<span class="comment">//输出到目标路径</span></div><div class="line">  &#125;);</div><div class="line"></div><div class="line">  gulp.task(<span class="string">'default'</span>,[<span class="string">'concat'</span>]);</div></pre></td></tr></table></figure>
<h4 id="9-5gulp-uglify"><a href="#9-5gulp-uglify" class="headerlink" title="9.5gulp-uglify"></a>9.5gulp-uglify</h4><p>合并后我们可以对JS文件进行压缩,最小化处理<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$  npm install gulp-uglify --save-dev</div></pre></td></tr></table></figure></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> gulp = <span class="built_in">require</span>(<span class="string">'gulp'</span>);</div><div class="line">    <span class="keyword">var</span> concat = <span class="built_in">require</span>(<span class="string">'gulp-concat'</span>);</div><div class="line">    <span class="keyword">var</span> uglify = <span class="built_in">require</span>(<span class="string">'gulp-uglify'</span>)</div><div class="line"></div><div class="line">    gulp.task(<span class="string">'uglify'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">return</span> gulp.src([<span class="string">'app/js/*.js'</span>,<span class="string">'!app/js/*.tmp.js'</span>])</div><div class="line">            .pipe(concat(<span class="string">'app.js'</span>)) <span class="comment">//把多个JS文件合并成一个文件</span></div><div class="line">            .pipe(uglify()) <span class="comment">//对合并后的app.js文件进行压缩</span></div><div class="line">            .pipe(gulp.dest(<span class="string">'dist/js'</span>)); <span class="comment">//输出到目的地</span></div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    gulp.task(<span class="string">'default'</span>,[<span class="string">'uglify'</span>]);</div></pre></td></tr></table></figure>
<h4 id="9-6gulp-rename"><a href="#9-6gulp-rename" class="headerlink" title="9.6gulp-rename"></a>9.6gulp-rename</h4><p>在把处理好的文件存放到指定的位置之前，我们可以先去重新命名一下它<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install gulp-rename --save-dev</div></pre></td></tr></table></figure></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> gulp = <span class="built_in">require</span>(<span class="string">'gulp'</span>);</div><div class="line">    <span class="keyword">var</span> concat = <span class="built_in">require</span>(<span class="string">'gulp-concat'</span>);</div><div class="line">    <span class="keyword">var</span> uglify = <span class="built_in">require</span>(<span class="string">'gulp-uglify'</span>);</div><div class="line">    <span class="keyword">var</span> rename = <span class="built_in">require</span>(<span class="string">'gulp-rename'</span>);</div><div class="line">    gulp.task(<span class="string">'uglify'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">return</span> gulp.src([<span class="string">'app/js/*.js'</span>,<span class="string">'!app/js/*.tmp.js'</span>])<span class="comment">//指定要处理的文件</span></div><div class="line">            .pipe(concat(<span class="string">'app.js'</span>))<span class="comment">//合并成一个文件</span></div><div class="line">            .pipe(gulp.dest(<span class="string">'dist/js'</span>))<span class="comment">//保存此文件</span></div><div class="line">            .pipe(uglify())<span class="comment">//进行压缩</span></div><div class="line">            .pipe(rename(<span class="string">'app.min.js'</span>))<span class="comment">//对此文件进行重命名</span></div><div class="line">            .pipe(gulp.dest(<span class="string">'dist/js'</span>));<span class="comment">//再输出一次</span></div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    gulp.task(<span class="string">'default'</span>,[<span class="string">'uglify'</span>]);</div></pre></td></tr></table></figure>
<h4 id="9-7-gulp-minify-css"><a href="#9-7-gulp-minify-css" class="headerlink" title="9.7 gulp-minify-css"></a>9.7 gulp-minify-css</h4><p>压缩css<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$    npm install gulp-minify-css --save-dev</div></pre></td></tr></table></figure></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> gulp = <span class="built_in">require</span>(<span class="string">'gulp'</span>);</div><div class="line">   <span class="keyword">var</span> less = <span class="built_in">require</span>(<span class="string">'gulp-less'</span>);</div><div class="line">   <span class="keyword">var</span> minify = <span class="built_in">require</span>(<span class="string">'gulp-minify-css'</span>);<span class="comment">//在文件的顶部去包含这个插件，起个名字，叫做 minify</span></div><div class="line">   <span class="keyword">var</span> rename = <span class="built_in">require</span>(<span class="string">'gulp-rename'</span>);</div><div class="line">   gulp.task(<span class="string">'minify'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">       <span class="keyword">return</span> gulp.src(<span class="string">'app/less/page.less'</span>)<span class="comment">//指定 less文件</span></div><div class="line">           .pipe(less())<span class="comment">//把less编译成css</span></div><div class="line">           .pipe(gulp.dest(<span class="string">'dist/css'</span>))<span class="comment">//输出到目的地</span></div><div class="line">           .pipe(minify())<span class="comment">//对 css再进行压缩</span></div><div class="line">           .pipe(rename(<span class="string">'page.min.css'</span>))<span class="comment">//重命名</span></div><div class="line">           .pipe(gulp.dest(<span class="string">'dist/css'</span>));<span class="comment">//输出到目的地</span></div><div class="line">   &#125;);</div><div class="line"></div><div class="line">   gulp.task(<span class="string">'default'</span>,[<span class="string">'less'</span>]);</div></pre></td></tr></table></figure>
<h4 id="9-8gulp-minify-html"><a href="#9-8gulp-minify-html" class="headerlink" title="9.8gulp-minify-html"></a>9.8gulp-minify-html</h4><p>html文件压缩<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install gulp-minify-html --save-dev</div></pre></td></tr></table></figure></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> gulp = <span class="built_in">require</span>(<span class="string">'gulp'</span>),</div><div class="line">        minifyHtml = <span class="built_in">require</span>(<span class="string">"gulp-minify-html"</span>);</div><div class="line"></div><div class="line">    gulp.task(<span class="string">'minify-html'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        gulp.src(<span class="string">'src/*.html'</span>) <span class="comment">// 要压缩的html文件</span></div><div class="line">        .pipe(minifyHtml())    <span class="comment">//压缩</span></div><div class="line">        .pipe(gulp.dest(<span class="string">'dist/html'</span>));<span class="comment">//输出到目的地</span></div><div class="line">    &#125;);</div></pre></td></tr></table></figure>
<h4 id="9-9gulp-imagemin"><a href="#9-9gulp-imagemin" class="headerlink" title="9.9gulp-imagemin"></a>9.9gulp-imagemin</h4><p>如果要想在保证不改变图像质量的情况下，让图像文件的体积变得更小一点,我们可以使用gulp-imagemin<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install gulp-imagemin --save-dev</div></pre></td></tr></table></figure></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> gulp = <span class="built_in">require</span>(<span class="string">'gulp'</span>);</div><div class="line"> <span class="keyword">var</span> imagemin = <span class="built_in">require</span>(<span class="string">'gulp-imagemin'</span>);</div><div class="line"></div><div class="line"> gulp.task(<span class="string">'copy-images'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">     <span class="keyword">return</span> gulp.src(<span class="string">'app/imgs/**/*.&#123;jpg,png&#125;'</span>)<span class="comment">//指定要压缩的图片</span></div><div class="line">         .pipe(imagemin()) <span class="comment">//进行图片压缩</span></div><div class="line">         .pipe(gulp.dest(<span class="string">'dist'</span>));<span class="comment">//输出目的地</span></div><div class="line"> &#125;);</div><div class="line"></div><div class="line">  gulp.task(<span class="string">'default'</span>,[<span class="string">'copy-images'</span>]);</div></pre></td></tr></table></figure>
<h4 id="9-10gulp-connect"><a href="#9-10gulp-connect" class="headerlink" title="9.10gulp-connect"></a>9.10gulp-connect</h4><p>有些时候我们需要把文件放到本地服务器上去预览，gulp-connect可以帮我们创建一个本地服务器去运行我们的项目<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install gulp-connect --save-dev</div></pre></td></tr></table></figure></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> gulp = <span class="built_in">require</span>(<span class="string">'gulp'</span>);</div><div class="line">    <span class="keyword">var</span> connect = <span class="built_in">require</span>(<span class="string">'gulp-connect'</span>);</div><div class="line"></div><div class="line">    gulp.task(<span class="string">'server'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">       connect.server(&#123;</div><div class="line">           <span class="attr">root</span>:<span class="string">'dist'</span>,<span class="comment">//服务器的根目录</span></div><div class="line">           port:<span class="number">8080</span> <span class="comment">//服务器的地址，没有此配置项默认也是 8080</span></div><div class="line">       &#125;);</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    gulp.task(<span class="string">'default'</span>,[<span class="string">'server'</span>]); <span class="comment">//运行此任务的时候会在8080上启动服务器，</span></div></pre></td></tr></table></figure>
<h4 id="9-11自动刷新"><a href="#9-11自动刷新" class="headerlink" title="9.11自动刷新"></a>9.11自动刷新</h4><p>我们希望当文件变化的时候浏览器可以自动刷新，这样我们就不需要文件修改后手动去刷新浏览器了<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> gulp = <span class="built_in">require</span>(<span class="string">'gulp'</span>);</div><div class="line">    <span class="keyword">var</span> connect = <span class="built_in">require</span>(<span class="string">'gulp-connect'</span>);</div><div class="line"></div><div class="line">    gulp.task(<span class="string">'copy-html'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">         gulp.src(<span class="string">'app/index.html'</span>)<span class="comment">//指定源文件</span></div><div class="line">             .pipe(gulp.dest(<span class="string">'dist'</span>))<span class="comment">//拷贝到dist目录</span></div><div class="line">             .pipe(connect.reload());<span class="comment">//通知浏览器重启</span></div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    gulp.task(<span class="string">'watch'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        gulp.watch(<span class="string">'app/index.html'</span>,[<span class="string">'copy-html'</span>]);<span class="comment">//当index.html文件变化时执行copy-html任务</span></div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    gulp.task(<span class="string">'server'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        connect.server(&#123;</div><div class="line">            <span class="attr">root</span>:<span class="string">'dist'</span>,<span class="comment">//服务器的根目录</span></div><div class="line">            port:<span class="number">8080</span>, <span class="comment">//服务器的地址，没有此配置项默认也是 8080</span></div><div class="line">            livereload:<span class="literal">true</span><span class="comment">//启用实时刷新的功能</span></div><div class="line">        &#125;);</div><div class="line">    &#125;);</div><div class="line">    gulp.task(<span class="string">'default'</span>,[<span class="string">'server'</span>,<span class="string">'watch'</span>]);<span class="comment">//运行此任务的时候会在8080上启动服务器，</span></div></pre></td></tr></table></figure></p>
<h4 id="9-12jshint"><a href="#9-12jshint" class="headerlink" title="9.12jshint"></a>9.12jshint</h4><p>可以用此插件进行代码检查,注意必须同时安装jshint和gulp-jshint 全部选项<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install jshint gulp-jshint  --save-dev</div></pre></td></tr></table></figure></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> gulp = <span class="built_in">require</span>(<span class="string">'gulp'</span>),</div><div class="line">        jshint = <span class="built_in">require</span>(<span class="string">"gulp-jshint"</span>);</div><div class="line"></div><div class="line">    gulp.task(<span class="string">'jsLint'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        gulp.src(<span class="string">'src/*.js'</span>)</div><div class="line">        .pipe(jshint()) <span class="comment">//进行代码检查</span></div><div class="line">        .pipe(jshint.reporter()); <span class="comment">// 输出检查结果</span></div><div class="line">    &#125;);</div></pre></td></tr></table></figure>
<h2 id="10-项目实战"><a href="#10-项目实战" class="headerlink" title="10.项目实战"></a>10.项目实战</h2><h4 id="10-1生成项目"><a href="#10-1生成项目" class="headerlink" title="10.1生成项目"></a>10.1生成项目</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$    mkdir gulpstart</div><div class="line">$    cd gulpstart</div><div class="line">$    npm install generator-gulp-webapp@0.2.0 -g</div><div class="line">$    yo gulp-webapp gulpstart</div></pre></td></tr></table></figure>
<h4 id="10-2阅读gulpfile-js文件"><a href="#10-2阅读gulpfile-js文件" class="headerlink" title="10.2阅读gulpfile.js文件"></a>10.2阅读gulpfile.js文件</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* jshint node:true */</span></div><div class="line"><span class="meta">'use strict'</span>;</div><div class="line"><span class="comment">// generated on 2015-10-15 using generator-gulp-webapp 0.2.0</span></div><div class="line"><span class="comment">//使用require把gulp引入进来</span></div><div class="line"><span class="keyword">var</span> gulp = <span class="built_in">require</span>(<span class="string">'gulp'</span>);</div><div class="line"><span class="comment">/**</span></div><div class="line"> * 读取package.json中的devDependencies配置项，调用gulp api把相关的插件加载进来</div><div class="line"> * 返回一个object,每个key指向各自的插件，把对象赋值给 $,后面可以用$获取每个插件的引用</div><div class="line"> * 如果不使用gulp-load-plugins,就可以使用require引入插件 如</div><div class="line"> *  var sass = require('gulp-sass');</div><div class="line"> *</div><div class="line"> */</div><div class="line"><span class="keyword">var</span> $ = <span class="built_in">require</span>(<span class="string">'gulp-load-plugins'</span>)();</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 1.此插件是用来编译sass的</div><div class="line"> * 2.</div><div class="line"> */</div><div class="line">gulp.task(<span class="string">'styles'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="comment">//把执行结果返回，以便此任务可以跟后续的任务配合依次执行。将多个小的操作进行组合，连接在一起就是流，数据依次从源头穿过一个个的管道，依次执行，最终在底部得到结果，可以很好的进行数据的转换</span></div><div class="line">  <span class="keyword">return</span> gulp.src(<span class="string">'app/styles/main.scss'</span>)<span class="comment">//读取此文件到数据流中</span></div><div class="line">  <span class="comment">/**</span></div><div class="line">   * 1.pipe是steam模块中负责传递流数据的方法，把前一个流里的数据以管道的方式传递给下一个管道。</div><div class="line">   * 2.标准的流当期中一个管道出错的时候会触发unpipe事件，会导致gulp报错并强制退出</div><div class="line">   * 我们现在监听main.scss文件的变化，一旦变化时会执行rubySass,但如果sass有语法错误，执行rubySass的时候会报错，会导致gulp报错并强制退出从而导致整个任务失败，watch就会失败，只能重启gulp服务。</div><div class="line">   * 然后不停的失败再重启，这样肯定是不可接受的。</div><div class="line">   * 3.plumber是水管工的意思，plumber通过替换pipe方法并移除onerror处理函数，这样即使有管道出问题了不会影响其它管道以及影响其它后续数据流的再处理。</div><div class="line">   * 当我们希望我们的管道能容忍容错的时候，就必须先通过plumber插件。</div><div class="line">   */</div><div class="line">      .pipe($.plumber())</div><div class="line">  <span class="comment">/**</span></div><div class="line">   * 通过 npm install gulp-ruby-sass 安装</div><div class="line">   */</div><div class="line">      .pipe($.rubySass(&#123;</div><div class="line">        <span class="attr">style</span>: <span class="string">'expanded'</span>,<span class="comment">// 设置编译出来的模式为expanded模式，一共有四种 nested(层级选择器嵌套) expanded(不嵌套) compact(属性合合并在一行) compressed(全部合并到一行)，请参考 http://sass-lang.com/documentation/file.SASS_REFERENCE.html#_13</span></div><div class="line">        precision: <span class="number">10</span> <span class="comment">//属性保留几位小数点 因为sass支持表达式，比如10/3,那么除不尽会有小数，我们尽可能保留完整，如果不能保留10位</span></div><div class="line">      &#125;))</div><div class="line">    <span class="comment">//需要厂商前缀的属性自动添加厂商前缀，只适配每种浏览器最新的一个版本</span></div><div class="line">      .pipe($.autoprefixer(&#123;<span class="attr">browsers</span>: [<span class="string">'last 1 version'</span>]&#125;))</div><div class="line">    <span class="comment">//处理完成后把流数据写入.tmp/styles目录</span></div><div class="line">      .pipe(gulp.dest(<span class="string">'.tmp/styles'</span>));</div><div class="line">&#125;);</div><div class="line">gulp.task(<span class="string">'jshint'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="comment">//对scripts目录下的JS进行校验，使用.jshintrc作为配置文件</span></div><div class="line">  <span class="comment">//配置文件说明 http://jinlong.github.io/2014/10/25/jshint-configuration/?utm_source=tuicool</span></div><div class="line">  <span class="keyword">return</span> gulp.src(<span class="string">'app/scripts/**/*.js'</span>)</div><div class="line">      .pipe($.jshint())</div><div class="line">    <span class="comment">//校验结果传递给jshint-stylish reporter</span></div><div class="line">      .pipe($.jshint.reporter(<span class="string">'jshint-stylish'</span>))<span class="comment">//传递的是report的名称</span></div><div class="line">    <span class="comment">//当校验没通过时会通过stylish记录下错误信息并传递给fail reporter,并使当前任务失败</span></div><div class="line">      .pipe($.jshint.reporter(<span class="string">'fail'</span>));</div><div class="line">&#125;);</div><div class="line">gulp.task(<span class="string">'html'</span>, [<span class="string">'styles'</span>], <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="comment">//lazypipe用来缓存一组管道配置，存起来稍后使用</span></div><div class="line">  <span class="keyword">var</span> lazypipe = <span class="built_in">require</span>(<span class="string">'lazypipe'</span>);</div><div class="line"></div><div class="line">  <span class="keyword">var</span> cssChannel = lazypipe()</div><div class="line">    <span class="comment">//注意传递的是插件对象而不是插件方法调用</span></div><div class="line">    <span class="comment">//csso用来压缩css文件</span></div><div class="line">      .pipe($.csso)</div><div class="line">    <span class="comment">//替换内容</span></div><div class="line">      .pipe($.replace, <span class="string">'bower_components/bootstrap-sass-official/assets/fonts/bootstrap'</span>,<span class="string">'fonts'</span>);</div><div class="line">  <span class="comment">//通过解析html中的注释块来处理替换html中那些未经合并压缩的JS CSS等资源的引入</span></div><div class="line">  <span class="comment">//分成二步  assets 和 useref</span></div><div class="line">  <span class="comment">// assets方法用来生成检索资源文件的管道</span></div><div class="line">  <span class="keyword">var</span> assets = $.useref.assets(&#123;<span class="attr">searchPath</span>: <span class="string">'&#123;.tmp,app&#125;'</span>&#125;);<span class="comment">//指定在哪些目录中搜索 html文件，是相对于gulp</span></div><div class="line"></div><div class="line">  <span class="keyword">return</span> gulp.src(<span class="string">'app/*.html'</span>)</div><div class="line">      .pipe(assets)<span class="comment">//检索传递进来的html文件，按注释指令对这些文件进行合并，然后生成一个新的流，将之前的HTML文件替换掉,新增加合并合的资源文件</span></div><div class="line">      .pipe($.<span class="keyword">if</span>(<span class="string">'*.js'</span>, $.uglify()))<span class="comment">//符合条件才能进入后面的流，如果是JS进行压缩再回归到主流</span></div><div class="line">      .pipe($.<span class="keyword">if</span>(<span class="string">'*.css'</span>, cssChannel()))<span class="comment">//如果是CSS文件，则先压缩CSS再替换fonts路径</span></div><div class="line">      .pipe(assets.restore())<span class="comment">//再回到主流，把删除的HTML文件添加回来</span></div><div class="line">      .pipe($.useref())<span class="comment">//修改原来注释块用修改后的引用地址替换掉原来的地址</span></div><div class="line">      .pipe($.<span class="keyword">if</span>(<span class="string">'*.html'</span>, $.minifyHtml(&#123;<span class="attr">conditionals</span>: <span class="literal">true</span><span class="comment">/*true不移除针对IE的注释*/</span>, <span class="attr">loose</span>: <span class="literal">true</span><span class="comment">/*压缩空格的时候至少保留一个空格*/</span>&#125;)))<span class="comment">//如果是html文件，则进行压缩</span></div><div class="line">      .pipe(gulp.dest(<span class="string">'dist'</span>));<span class="comment">//把处理后的文件输出到dist目录</span></div><div class="line">&#125;);</div><div class="line">gulp.task(<span class="string">'images'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> gulp.src(<span class="string">'app/images/**/*'</span>)<span class="comment">//把图片读取入流中</span></div><div class="line">  <span class="comment">/**</span></div><div class="line">   * 为了避免图片多次压缩失真</div><div class="line">   * imagemin只负责压缩图片，不负责检查图片是否被压缩过</div><div class="line">   * 为了避免二次压缩使用$.cache，维护一份临时文件记录哪些文件已经被处理过了，处理过了则不再传递给它包装的管道。</div><div class="line">   */</div><div class="line">      .pipe($.cache($.imagemin(&#123;</div><div class="line">        <span class="attr">progressive</span>: <span class="literal">true</span>,<span class="comment">//针对jpg 图像逐行扫描，先以比较模糊的方式出现，再清晰。</span></div><div class="line">        interlaced: <span class="literal">true</span> <span class="comment">//针夺gif,隔行扫描的方式。比如先出奇数行，再出偶数行，一半的时间就可以看到轮廓。</span></div><div class="line">      &#125;)))</div><div class="line">      .pipe(gulp.dest(<span class="string">'dist/images'</span>));<span class="comment">//输出到images目录</span></div><div class="line">&#125;);</div><div class="line">gulp.task(<span class="string">'fonts'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="comment">//main-bower-files 读取所有的bower的文件并合并上所有的字体文件读取入流</span></div><div class="line">  <span class="keyword">return</span> gulp.src(<span class="built_in">require</span>(<span class="string">'main-bower-files'</span>)().concat(<span class="string">'app/fonts/**/*'</span>))</div><div class="line">      .pipe($.filter(<span class="string">'**/*.&#123;eot,svg,ttf,woff&#125;'</span>))<span class="comment">//类似于if,符合流转，不符合则被剔除</span></div><div class="line">      .pipe($.flatten())<span class="comment">//将相对路径移除</span></div><div class="line">      .pipe(gulp.dest(<span class="string">'dist/fonts'</span>));<span class="comment">//将字体文件写入fonts目录</span></div><div class="line">&#125;);</div><div class="line"><span class="comment">//将app下除了html以外的文件拷贝到dist目录 只拷贝一级</span></div><div class="line">gulp.task(<span class="string">'extras'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> gulp.src([</div><div class="line">    <span class="string">'app/*.*'</span>,</div><div class="line">    <span class="string">'!app/*.html'</span>,</div><div class="line">    <span class="string">'node_modules/apache-server-configs/dist/.htaccess'</span><span class="comment">//拷贝apache配置文件</span></div><div class="line">  ], &#123;</div><div class="line">    <span class="attr">dot</span>: <span class="literal">true</span><span class="comment">// node glob配置项，true时匹配以.开头的文件或文件夹</span></div><div class="line">  &#125;).pipe(gulp.dest(<span class="string">'dist'</span>));</div><div class="line">&#125;);</div><div class="line"><span class="comment">//删除.tmp和dist下的所有文件</span></div><div class="line">gulp.task(<span class="string">'clean'</span>, <span class="built_in">require</span>(<span class="string">'del'</span>).bind(<span class="literal">null</span>, [<span class="string">'.tmp'</span>, <span class="string">'dist'</span>]));</div><div class="line"><span class="comment">//等同于 gulp.task('clean',function()&#123;require('del')(['.tmp','dist'])&#125;);</span></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 1.connect会依赖styles</div><div class="line"> * 2.这是一个node扩展的http框架，可以使用中间件方便配置</div><div class="line"> */</div><div class="line">gulp.task(<span class="string">'connect'</span>, [<span class="string">'styles'</span>], <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> serveStatic = <span class="built_in">require</span>(<span class="string">'serve-static'</span>);<span class="comment">//静态文件服务器中间件</span></div><div class="line">  <span class="keyword">var</span> serveIndex = <span class="built_in">require</span>(<span class="string">'serve-index'</span>);<span class="comment">//显示索引文件中间件</span></div><div class="line">  <span class="keyword">var</span> app = <span class="built_in">require</span>(<span class="string">'connect'</span>)()<span class="comment">//先创建connect对象叫app</span></div><div class="line">  <span class="comment">/**</span></div><div class="line">   * 此中间件就是自动为html插入livereload脚本，通过参数传递配置项参数</div><div class="line">   */</div><div class="line">      .use(<span class="built_in">require</span>(<span class="string">'connect-livereload'</span>)(&#123;<span class="attr">port</span>: <span class="number">35729</span>&#125;))<span class="comment">//实时重启服务器中间件</span></div><div class="line">      .use(serveStatic(<span class="string">'.tmp'</span>))<span class="comment">//对根目录的请求映射到.tmp目录</span></div><div class="line">      .use(serveStatic(<span class="string">'app'</span>))<span class="comment">//对根目录的请求映射到app目录</span></div><div class="line">    <span class="comment">//将对bower_components目录的访问定位到bower_components目录下</span></div><div class="line">      .use(<span class="string">'/bower_components'</span>, serveStatic(<span class="string">'bower_components'</span>))</div><div class="line">    <span class="comment">//参数为本地的一个文件目录，当路径命中这个目录的时候，而路径下没有index文件的时候会显示目录索引文件显示此目录下的所的文件</span></div><div class="line">      .use(serveIndex(<span class="string">'app'</span>));</div><div class="line">  <span class="comment">//加载http组件并创建http服务器，传入的参数app就是一个请求监听处理函数</span></div><div class="line">  <span class="comment">//当服务器接受请求的时候，会依次执行上面的一系列中间件，其实就是用请求路径在相应的文件夹里进行匹配，如果匹配上就返回</span></div><div class="line">  <span class="built_in">require</span>(<span class="string">'http'</span>).createServer(app)</div><div class="line">      .listen(<span class="number">9000</span>)</div><div class="line">    <span class="comment">//服务器监听成功后会输出此信息</span></div><div class="line">      .on(<span class="string">'listening'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'Started connect web server on http://localhost:9000'</span>);</div><div class="line">      &#125;);</div><div class="line">&#125;);</div><div class="line"><span class="comment">/**</span></div><div class="line"> * 1. 在命令行中执行 gulp serve 就可以自动打开浏览器，然后修改app/index.html就会实时刷新浏览器</div><div class="line"> * 2.因为watch依赖connect,所以这里connect可以省略</div><div class="line"> * 3.</div><div class="line"> *</div><div class="line"> */</div><div class="line">gulp.task(<span class="string">'serve'</span>, [<span class="string">'connect'</span>, <span class="string">'watch'</span>], <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="comment">//打开浏览器并打开指定的URL地址</span></div><div class="line">  <span class="built_in">require</span>(<span class="string">'opn'</span>)(<span class="string">'http://localhost:9000'</span>);</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">//插入bower_component文件</span></div><div class="line">gulp.task(<span class="string">'wiredep'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> wiredep = <span class="built_in">require</span>(<span class="string">'wiredep'</span>).stream;</div><div class="line">  <span class="comment">//先处理sass文件对bower_component文件的依赖</span></div><div class="line">  gulp.src(<span class="string">'app/styles/*.scss'</span>)</div><div class="line">      .pipe(wiredep())</div><div class="line">      .pipe(gulp.dest(<span class="string">'app/styles'</span>));</div><div class="line"></div><div class="line">  <span class="comment">//处理app下的html文件对bower_component文件的依赖</span></div><div class="line">  gulp.src(<span class="string">'app/*.html'</span>)</div><div class="line">      .pipe(wiredep(&#123;<span class="attr">exclude</span>: [<span class="string">'bootstrap-sass-official'</span>]&#125;))<span class="comment">//排除bootstrap-sass-official</span></div><div class="line">      .pipe(gulp.dest(<span class="string">'app'</span>));</div><div class="line">&#125;);</div><div class="line"><span class="comment">/**</span></div><div class="line"> * 1. watch依赖connect执行</div><div class="line"> * 2.</div><div class="line"> */</div><div class="line">gulp.task(<span class="string">'watch'</span>, [<span class="string">'connect'</span>], <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="comment">/**</span></div><div class="line">   * 1.先调用livereload的listen方法启动监听,这样文件发生改动时就可以接收到变化通知了</div><div class="line">   * 原理都是一样的，即通过在本地开启一个websocket服务，检测文件变化，当文件被修改后触发livereload任务，推送消息给浏览器刷新页面。详情参考</div><div class="line">   * http://blog.csdn.net/u010373419/article/details/38184333?utm_source=tuicool</div><div class="line">   */</div><div class="line">  $.livereload.listen();</div><div class="line"></div><div class="line">  <span class="comment">//监听文件的变化，当文件发生变化的时候重启服务器</span></div><div class="line">  <span class="comment">//gulp.watch返回的一个eventEmitter对象，通过on change可以添加事件监听 ，当watch监控这些文件发生变化的时候可以发射change事件，从而调用$.livereload.changed监听函数执行，这就是订阅者设计模式</span></div><div class="line">  <span class="comment">//监听函数可以获得哪些文件发生了改变，通过livereload服务器哪些文件变更了，</span></div><div class="line">  gulp.watch([</div><div class="line">    <span class="string">'app/*.html'</span>,</div><div class="line">    <span class="string">'.tmp/styles/**/*.css'</span>,</div><div class="line">    <span class="string">'app/scripts/**/*.js'</span>,</div><div class="line">    <span class="string">'app/images/**/*'</span></div><div class="line">  ]).on(<span class="string">'change'</span>, $.livereload.changed);</div><div class="line">  <span class="comment">//当scss文件变化的时候重新编译sass</span></div><div class="line">  gulp.watch(<span class="string">'app/styles/**/*.scss'</span>, [<span class="string">'styles'</span>]);</div><div class="line">  <span class="comment">//当bower.json文件发生变化的时候自动重启把依赖的组件引入html文件</span></div><div class="line">  gulp.watch(<span class="string">'bower.json'</span>, [<span class="string">'wiredep'</span>]);</div><div class="line">&#125;);</div><div class="line"><span class="comment">/**</span></div><div class="line"> *编译</div><div class="line"> *</div><div class="line"> */</div><div class="line">gulp.task(<span class="string">'build'</span>, [<span class="string">'jshint'</span>, <span class="string">'html'</span>, <span class="string">'images'</span>, <span class="string">'fonts'</span>, <span class="string">'extras'</span>], <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="comment">//size展示文件大小以及总的大小 gzip为true展示gzip压缩后的文件大小,展示的是项目的总大小</span></div><div class="line">  <span class="keyword">return</span> gulp.src(<span class="string">'dist/**/*'</span>).pipe($.size(&#123;<span class="attr">title</span>: <span class="string">'build'</span>, <span class="attr">gzip</span>: <span class="literal">true</span>&#125;));</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 组合任务</div><div class="line"> *</div><div class="line"> */</div><div class="line">gulp.task(<span class="string">'default'</span>, [<span class="string">'clean'</span>], <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  gulp.start(<span class="string">'build'</span>);<span class="comment">//start 可以运行build任务</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h2 id="11-自定义插件"><a href="#11-自定义插件" class="headerlink" title="11.自定义插件"></a>11.自定义插件</h2><h4 id="11-1vinyl"><a href="#11-1vinyl" class="headerlink" title="11.1vinyl"></a>11.1vinyl</h4><p>gulp.src中这个流里的内容不是原始的文件流,而是一个虚拟文件对象流,这个虚拟文件对象中存储着原始文件的路径、文件名和内容等信息 vinyl<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> File = <span class="built_in">require</span>(<span class="string">'vinyl'</span>);</div><div class="line"></div><div class="line"><span class="keyword">var</span> indexFile = <span class="keyword">new</span> File(&#123;</div><div class="line">    <span class="attr">cwd</span>: <span class="string">"/"</span>,<span class="comment">//当前路径</span></div><div class="line">    base: <span class="string">"/test/"</span>,<span class="comment">//文件名</span></div><div class="line">    path: <span class="string">"/test/index.js"</span>,<span class="comment">//路径</span></div><div class="line">    contents: <span class="keyword">new</span> Buffer(<span class="string">"name=zfpx"</span>)<span class="comment">//文件内容</span></div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(File.isVinyl(indexFile));<span class="comment">//是否是vinyl</span></div><div class="line"><span class="built_in">console</span>.log(indexFile.isBuffer());<span class="comment">//内容是否是Buffer</span></div><div class="line"><span class="built_in">console</span>.log(indexFile.isStream());<span class="comment">//内容是否是Stream</span></div></pre></td></tr></table></figure></p>
<h4 id="11-2through2"><a href="#11-2through2" class="headerlink" title="11.2through2"></a>11.2through2</h4><p><a href="https://www.npmjs.com/package/through2" target="_blank" rel="external">https://www.npmjs.com/package/through2</a> 二进制流的方式<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> through2 = <span class="built_in">require</span>(<span class="string">'through2'</span>);</div><div class="line"> <span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</div><div class="line"></div><div class="line"> fs.createReadStream(<span class="string">'src.txt'</span>,&#123;<span class="attr">highWaterMark</span>:<span class="number">1</span>&#125;)</div><div class="line">     .pipe(through2(<span class="function"><span class="keyword">function</span> (<span class="params">chunk, encoding, callback</span>) </span>&#123;</div><div class="line">         <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; chunk.length; i++)</div><div class="line">             chunk[i] = chunk[i] + <span class="number">1</span>;</div><div class="line">         <span class="keyword">this</span>.push(chunk); <span class="comment">//向流中写数据,每push一次就发射一次data事件</span></div><div class="line">         callback();</div><div class="line">     &#125;)).on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(data.toString());</div><div class="line">     &#125;).on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'end'</span>);</div><div class="line"> &#125;)</div><div class="line"> <span class="comment">//.pipe(fs.createWriteStream('dest.txt'))</span></div></pre></td></tr></table></figure></p>
<p>对象方式<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> through2 = <span class="built_in">require</span>(<span class="string">'through2'</span>);</div><div class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</div><div class="line"><span class="keyword">var</span> all = [];</div><div class="line">fs.createReadStream(<span class="string">'src.txt'</span>, &#123;<span class="attr">highWaterMark</span>: <span class="number">1</span>&#125;)</div><div class="line">    .pipe(through2.obj(<span class="function"><span class="keyword">function</span> (<span class="params">chunk, enc, callback</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> data = &#123;</div><div class="line">            <span class="attr">name</span>: chunk.toString()</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">this</span>.push(data);</div><div class="line">        callback();</div><div class="line">    &#125;))</div><div class="line">    .on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(data)</div><div class="line">    &#125;)</div><div class="line">    .on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'end'</span>)</div><div class="line">    &#125;)</div></pre></td></tr></table></figure></p>
<h4 id="11-3buffer往头部增加内容插件"><a href="#11-3buffer往头部增加内容插件" class="headerlink" title="11.3buffer往头部增加内容插件"></a>11.3buffer往头部增加内容插件</h4><p>如果你的插件依赖着一个基于 buffer 处理的库，你可能会选择让你的插件以 buffer 的形式来处理 file.contents。让我们来实现一个在文件头部插入额外文本的插件：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> through = <span class="built_in">require</span>(<span class="string">'through2'</span>);</div><div class="line"><span class="keyword">var</span> PluginError = <span class="built_in">require</span>(<span class="string">'gulp-util'</span>).PluginError;</div><div class="line"><span class="keyword">const</span> PLUGIN_NAME = <span class="string">'gulp-prefixer'</span>;</div><div class="line"></div><div class="line"><span class="comment">// 插件级别的函数（处理文件）</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">gulpPrefixer</span>(<span class="params">prefixText</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (!prefixText) &#123;</div><div class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> PluginError(PLUGIN_NAME, <span class="string">'Missing prefix text!'</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    prefixText = <span class="keyword">new</span> Buffer(prefixText); <span class="comment">// 提前分配</span></div><div class="line">     <span class="comment">// 创建一个 stream 通道，以让每个文件通过</span></div><div class="line">        <span class="keyword">var</span> stream = through.obj(<span class="function"><span class="keyword">function</span>(<span class="params">file, enc, cb</span>) </span>&#123;</div><div class="line">            <span class="keyword">if</span> (file.isStream()) &#123;</div><div class="line">                <span class="keyword">this</span>.emit(<span class="string">'error'</span>, <span class="keyword">new</span> PluginError(PLUGIN_NAME, <span class="string">'Streams are not supported!'</span>));</div><div class="line">                <span class="keyword">return</span> cb();</div><div class="line">            &#125;</div><div class="line">    </div><div class="line">            <span class="keyword">if</span> (file.isBuffer()) &#123;</div><div class="line">                file.contents = Buffer.concat([prefixText, file.contents]);</div><div class="line">            &#125;</div><div class="line">    </div><div class="line">            <span class="comment">// 确保文件进入下一个 gulp 插件</span></div><div class="line">            <span class="keyword">this</span>.push(file);</div><div class="line">    </div><div class="line">            <span class="comment">// 告诉 stream 引擎，我们已经处理完了这个文件</span></div><div class="line">            cb();</div><div class="line">        &#125;);</div><div class="line">    </div><div class="line">        <span class="comment">// 返回文件 stream</span></div><div class="line">        <span class="keyword">return</span> stream;</div><div class="line">    &#125;;</div><div class="line"><span class="comment">// 导出插件主函数</span></div><div class="line"><span class="built_in">module</span>.exports = gulpPrefixer;</div></pre></td></tr></table></figure></p>
<p>上述的插件可以这样使用：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> gulp = <span class="built_in">require</span>(<span class="string">'gulp'</span>);</div><div class="line"><span class="keyword">var</span> gulpPrefixer = <span class="built_in">require</span>(<span class="string">'gulp-prefixer'</span>);</div><div class="line"></div><div class="line">gulp.src(<span class="string">'files/**/*.js'</span>)</div><div class="line">  .pipe(gulpPrefixer(<span class="string">'prepended string'</span>))</div><div class="line">  .pipe(gulp.dest(<span class="string">'modified-files'</span>));</div></pre></td></tr></table></figure></p>
<h4 id="11-4stream往头部增加内容插件"><a href="#11-4stream往头部增加内容插件" class="headerlink" title="11.4stream往头部增加内容插件"></a>11.4stream往头部增加内容插件</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> through = <span class="built_in">require</span>(<span class="string">'through2'</span>);</div><div class="line"> <span class="keyword">var</span> PluginError = <span class="built_in">require</span>(<span class="string">'gulp-util'</span>).PluginError;</div><div class="line"></div><div class="line"> <span class="comment">//常量</span></div><div class="line"> <span class="keyword">const</span> PLUGIN_NAME = <span class="string">'gulp-prefixer'</span>;</div><div class="line"></div><div class="line"> <span class="function"><span class="keyword">function</span> <span class="title">prefixStream</span>(<span class="params">prefixText</span>) </span>&#123;</div><div class="line">     <span class="keyword">var</span> stream = through();</div><div class="line">     stream.write(prefixText);</div><div class="line">     <span class="keyword">return</span> stream;</div><div class="line"> &#125;</div><div class="line"></div><div class="line"> <span class="comment">// 插件级别函数 (处理文件)</span></div><div class="line"> <span class="function"><span class="keyword">function</span> <span class="title">gulpPrefixer</span>(<span class="params">prefixText</span>) </span>&#123;</div><div class="line">     <span class="keyword">if</span> (!prefixText) &#123;</div><div class="line">         <span class="keyword">throw</span> <span class="keyword">new</span> PluginError(PLUGIN_NAME, <span class="string">'Missing prefix text!'</span>);</div><div class="line">     &#125;</div><div class="line">     prefixText = <span class="keyword">new</span> Buffer(prefixText); <span class="comment">// 预先分配</span></div><div class="line">     </div><div class="line">          <span class="comment">// 创建一个让每个文件通过的 stream 通道</span></div><div class="line">          <span class="keyword">var</span> stream = through.obj(<span class="function"><span class="keyword">function</span> (<span class="params">file, enc, cb</span>) </span>&#123;</div><div class="line">              <span class="keyword">if</span> (file.isBuffer()) &#123;</div><div class="line">                  <span class="keyword">this</span>.emit(<span class="string">'error'</span>, <span class="keyword">new</span> PluginError(PLUGIN_NAME, <span class="string">'Buffers not supported!'</span>));</div><div class="line">                  <span class="keyword">return</span> cb();</div><div class="line">              &#125;</div><div class="line">     </div><div class="line">              <span class="keyword">if</span> (file.isStream()) &#123;</div><div class="line">                  <span class="comment">// 定义转换内容的 streamer</span></div><div class="line">                  <span class="keyword">var</span> streamer = prefixStream(prefixText);</div><div class="line">                  <span class="comment">// 从 streamer 中捕获错误，并发出一个 gulp的错误</span></div><div class="line">                  streamer.on(<span class="string">'error'</span>, <span class="keyword">this</span>.emit.bind(<span class="keyword">this</span>, <span class="string">'error'</span>));</div><div class="line">                  <span class="comment">// 开始转换</span></div><div class="line">                  file.contents = file.contents.pipe(streamer);</div><div class="line">              &#125;</div><div class="line">     </div><div class="line">              <span class="comment">// 确保文件进去下一个插件</span></div><div class="line">              <span class="keyword">this</span>.push(file);</div><div class="line">              <span class="comment">// 告诉 stream 转换工作完成</span></div><div class="line">              cb();</div><div class="line">          &#125;);</div><div class="line">     </div><div class="line">          <span class="comment">// 返回文件 stream</span></div><div class="line">          <span class="keyword">return</span> stream;</div><div class="line">      &#125;</div><div class="line">      <span class="comment">// 暴露（export）插件的主函数</span></div><div class="line">       <span class="built_in">module</span>.exports = gulpPrefixer;</div></pre></td></tr></table></figure>
<p>上述的插件可以这样使用：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> gulp = <span class="built_in">require</span>(<span class="string">'gulp'</span>);</div><div class="line"><span class="keyword">var</span> gulpPrefixer = <span class="built_in">require</span>(<span class="string">'gulp-prefixer'</span>);</div><div class="line"></div><div class="line">gulp.src(<span class="string">'files/**/*.js'</span>, &#123; <span class="attr">buffer</span>: <span class="literal">false</span> &#125;)</div><div class="line">  .pipe(gulpPrefixer(<span class="string">'prepended string'</span>))</div><div class="line">  .pipe(gulp.dest(<span class="string">'modified-files'</span>));</div></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/07/27/gulp/" data-id="cj5riv72900037ou2lrc5e3xj" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2017/04/17/Blog/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Blog
        
      </div>
    </a>
  
  
    <a href="/2017/07/31/websocket/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">websocket</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/07/31/websocket/">websocket</a>
          </li>
        
          <li>
            <a href="/2017/07/27/gulp/">gulp</a>
          </li>
        
          <li>
            <a href="/2017/04/17/Blog/">Blog</a>
          </li>
        
          <li>
            <a href="/2017/04/14/angular/">angular</a>
          </li>
        
          <li>
            <a href="/2017/04/14/正则/">正则</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>